"use strict";(self.webpackChunkangular_anb=self.webpackChunkangular_anb||[]).push([[8967],{53023:(H,b,i)=>{i.d(b,{hN:()=>J,P0:()=>C,cW:()=>E});var j=i(15861),N=i(26584),B=i(33190),V=i(11519),p=i(91179),O=i(37053);function g(r,s){return r?s?4:3:s?3:2}function y(r,s,R,P,U){if(!r)return!1;const T=g(s,R),{coords:t,lengths:n}=r;let l=!1,u=0;for(const f of n)l=v(l,t,T,u,f,P,U),u+=f*T;return l}function v(r,s,R,P,U,T,t){let n=r,l=P;for(let u=P,f=P+U*R;u<f;u+=R){l=u+R,l===f&&(l=P);const M=s[u],I=s[u+1],h=s[l],W=s[l+1];(I<t&&W>=t||W<t&&I>=t)&&M+(t-I)/(W-I)*(h-M)<T&&(n=!n)}return n}var G=i(82054),A=i(88071),x=i(82959),D=i(6185);const F="feature-store:unsupported-query",L={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},K_spatialRelationship={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},K_queryGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},K_layerGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function _(r){return!0===K_spatialRelationship[r]}function e(r){return!0===K_queryGeometry[(0,p.Ji)(r)]}function o(r){return!0===K_layerGeometry[r]}function E(r,s,R,P,U){if((0,p.oU)(s)&&"esriGeometryPoint"===R&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){const T=(0,G.Uy)(new A.Z,s,!1,!1);return Promise.resolve(t=>function a(r,s,R,P){return y(r,s,R,P.coords[0],P.coords[1])}(T,!1,!1,t))}if((0,p.oU)(s)&&"esriGeometryMultipoint"===R){const T=(0,G.Uy)(new A.Z,s,!1,!1);if("esriSpatialRelContains"===r)return Promise.resolve(t=>function m(r,s,R,P,U,T){const t=g(U,T),{coords:n,lengths:l}=P;if(!l)return!1;for(let u=0,f=0;u<l.length;u++,f+=t)if(!y(r,s,R,n[f],n[f+1]))return!1;return!0}(T,!1,!1,t,P,U))}if((0,p.YX)(s)&&"esriGeometryPoint"===R&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))return Promise.resolve(T=>(0,B.aV)(s,(0,D.Op)(R,P,U,T)));if((0,p.YX)(s)&&"esriGeometryMultipoint"===R&&"esriSpatialRelContains"===r)return Promise.resolve(T=>(0,B.lQ)(s,(0,D.Op)(R,P,U,T)));if((0,p.YX)(s)&&"esriSpatialRelIntersects"===r){const T=function w(r){return"mesh"===r?V.h_:(0,V.IY)(r)}(R);return Promise.resolve(t=>T(s,(0,D.Op)(R,P,U,t)))}return function S(){return Promise.all([i.e(4918),i.e(8592),i.e(2825)]).then(i.bind(i,32825))}().then(T=>{const t=T[L[r]].bind(null,s.spatialReference,s);return n=>t((0,D.Op)(R,P,U,n))})}function C(r,s,R){return Z.apply(this,arguments)}function Z(){return(Z=(0,j.Z)(function*(r,s,R){const{spatialRel:P,geometry:U}=r;if(U){if(!_(P))throw new N.Z(F,"Unsupported query spatial relationship",{query:r});if((0,O.JY)(U.spatialReference)&&(0,O.JY)(R)){if(!e(U))throw new N.Z(F,"Unsupported query geometry type",{query:r});if(!o(s))throw new N.Z(F,"Unsupported layer geometry type",{query:r});if(r.outSR)return(0,x._W)(r.geometry&&r.geometry.spatialReference,r.outSR)}}})).apply(this,arguments)}function J(r){if((0,p.YX)(r))return!0;if((0,p.oU)(r)){for(const s of r.rings)if(5!==s.length||s[0][0]!==s[1][0]||s[0][0]!==s[4][0]||s[2][0]!==s[3][0]||s[0][1]!==s[3][1]||s[0][1]!==s[4][1]||s[1][1]!==s[2][1])return!1;return!0}return!1}},76530:(H,b,i)=>{function j(p,O){if(!p)return null;const g=O.featureAdapter,{startTimeField:a,endTimeField:m}=p;let y=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;if(a&&m)O.forEach(G=>{const A=g.getAttribute(G,a),x=g.getAttribute(G,m);null==A||isNaN(A)||(y=Math.min(y,A)),null==x||isNaN(x)||(v=Math.max(v,x))});else{const G=a||m;O.forEach(A=>{const x=g.getAttribute(A,G);null==x||isNaN(x)||(y=Math.min(y,x),v=Math.max(v,x))})}return{start:y,end:v}}function N(p,O,g){if(!O||!p)return null;const{startTimeField:a,endTimeField:m}=p;if(!a&&!m)return null;const{start:y,end:v}=O;return null===y&&null===v?null:void 0===y&&void 0===v?()=>!1:a&&m?function B(p,O,g,a,m){return null!=a&&null!=m?y=>{const v=p.getAttribute(y,O),G=p.getAttribute(y,g);return(null==v||v<=m)&&(null==G||G>=a)}:null!=a?y=>{const v=p.getAttribute(y,g);return null==v||v>=a}:null!=m?y=>{const v=p.getAttribute(y,O);return null==v||v<=m}:void 0}(g,a,m,y,v):function V(p,O,g,a){return null!=g&&null!=a&&g===a?m=>p.getAttribute(m,O)===g:null!=g&&null!=a?m=>{const y=p.getAttribute(m,O);return y>=g&&y<=a}:null!=g?m=>p.getAttribute(m,O)>=g:null!=a?m=>p.getAttribute(m,O)<=a:void 0}(g,a||m,y,v)}i.d(b,{R:()=>j,y:()=>N})},6185:(H,b,i)=>{i.d(b,{vF:()=>G,S2:()=>P,Op:()=>_,Up:()=>e,j6:()=>C,EG:()=>L});var j=i(15861),N=i(2076),B=i(62208),V=i(16730),w=i(15176),p=i(91179),O=i(62825),g=i(37053),a=i(82054),m=i(88071),y=i(82959);const v=new N.Xn({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),G=Object.freeze({}),A=new m.Z,x=new m.Z,D=new m.Z,F={esriGeometryPoint:a.fQ,esriGeometryPolyline:a.J6,esriGeometryPolygon:a.eG,esriGeometryMultipoint:a.Iv};function L(t,n,l,u=t.hasZ,f=t.hasM){if((0,B.Wi)(n))return null;const M=t.hasZ&&u,I=t.hasM&&f;if(l){const h=(0,a.Nh)(D,n,t.hasZ,t.hasM,"esriGeometryPoint",l,u,f);return(0,a.fQ)(h,M,I)}return(0,a.fQ)(n,M,I)}function _(t,n,l,u,f,M,I=n,h=l){const W=n&&I,Q=l&&h,Y=(0,B.pC)(u)?"coords"in u?u:u.geometry:null;if((0,B.Wi)(Y))return null;if(f){let z=(0,a.zj)(x,Y,n,l,t,f,I,h);return M&&(z=(0,a.Nh)(D,z,W,Q,t,M)),F[t](z,W,Q)}if(M){const z=(0,a.Nh)(D,Y,n,l,t,M,I,h);return F[t](z,W,Q)}return(0,a.hY)(A,Y,n,l,I,h),F[t](A,W,Q)}function e(t,n,l){return o.apply(this,arguments)}function o(){return(o=(0,j.Z)(function*(t,n,l){const{outFields:u,orderByFields:f,groupByFieldsForStatistics:M,outStatistics:I}=t;if(u)for(let h=0;h<u.length;h++)u[h]=u[h].trim();if(f)for(let h=0;h<f.length;h++)f[h]=f[h].trim();if(M)for(let h=0;h<M.length;h++)M[h]=M[h].trim();if(I)for(let h=0;h<I.length;h++)I[h].onStatisticField&&(I[h].onStatisticField=I[h].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),C(t,n,l)})).apply(this,arguments)}function C(t,n,l){return Z.apply(this,arguments)}function Z(){return(Z=(0,j.Z)(function*(t,n,l){if(!t)return null;let{where:u}=t;if(t.where=u=u&&u.trim(),(!u||/^1 *= *1$/.test(u)||n&&n===u)&&(t.where=null),!t.geometry)return t;let f=yield J(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:W}=t.geometry;f=(0,w.aO)(f),f.spatialReference=W}t.geometry=f,yield(0,y._W)(f.spatialReference,l);const M=(yield(0,O.aX)((0,p.im)(f)))[0];if((0,B.Wi)(M))throw G;const I=M.toJSON(),h=yield(0,y.iV)(I,I.spatialReference,l);if(!h)throw G;return h.spatialReference=l,t.geometry=h,t})).apply(this,arguments)}function J(t){return r.apply(this,arguments)}function r(){return(r=(0,j.Z)(function*(t){const{geometry:n,distance:l,units:u}=t;if(null==l||"vertexAttributes"in n)return n;const f=n.spatialReference,M=u?v.fromJSON(u):(0,V.qE)(f),I=f&&((0,g.sT)(f)||(0,g.sS)(f))?n:yield(0,y._W)(f,g.Zn).then(()=>(0,y.iV)(n,g.Zn));return(yield s())(I.spatialReference,I,l,M)})).apply(this,arguments)}function s(){return R.apply(this,arguments)}function R(){return(R=(0,j.Z)(function*(){return(yield Promise.all([i.e(4918),i.e(8592),i.e(2825)]).then(i.bind(i,32825))).geodesicBuffer})).apply(this,arguments)}function P(t){return t&&U in t?JSON.parse(JSON.stringify(t,T)):t}const U="_geVersion",T=(t,n)=>t!==U?n:void 0},8967:(H,b,i)=>{i.r(b),i.d(b,{default:()=>K});var j=i(15861),N=i(26584),B=i(63290),V=i(62208),w=i(65401),p=i(32442),O=i(53023),g=i(76530),a=i(6185),m=i(84952),y=i(55746);const v=B.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),G={getAttribute:(_,e)=>_.field(e)};function x(){return(x=(0,j.Z)(function*(_,e){const o=yield i.e(410).then(i.bind(i,10410));try{const S=o.WhereClause.create(_,e);if(!S.isStandardized){const E=new N.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",S);v.error(E)}return E=>{const C=E.readArcadeFeature();return S.testFeature(C,G)}}catch(S){return v.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",_),E=>!0}})).apply(this,arguments)}const D=B.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");class K{constructor(e){this._geometryBounds=(0,w.Ue)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach((e,o)=>{this._idToVisibility.set(o,0)})}setKnownIds(e){for(const o of e)this._idToVisibility.set(o,1)}setTrue(e){const o=[],S=[],E=new Set(e);return this._idToVisibility.forEach((C,Z)=>{const J=!!(1&this._idToVisibility.get(Z)),r=E.has(Z);!J&&r?o.push(Z):J&&!r&&S.push(Z),this._idToVisibility.set(Z,r?3:0)}),{show:o,hide:S}}createQuery(){const{geometry:e,spatialRel:o,where:S,timeExtent:E,objectIds:C}=this;return m.Z.fromJSON({geometry:e,spatialRel:o,where:S,timeExtent:E,objectIds:C})}update(e,o){var S=this;return(0,j.Z)(function*(){S._hash=JSON.stringify(e);const E=yield(0,a.j6)(e,null,o);yield Promise.all([S._setGeometryFilter(E),S._setIdFilter(E),S._setAttributeFilter(E),S._setTimeFilter(E)])})()}_setAttributeFilter(e){var o=this;return(0,j.Z)(function*(){if(!e||!e.where)return o._clause=null,void(o.where=null);o._clause=yield function A(_,e){return x.apply(this,arguments)}(e.where,o._serviceInfo.fieldsIndex),o.where=e.where})()}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}_setGeometryFilter(e){var o=this;return(0,j.Z)(function*(){if(!e||!e.geometry)return o._spatialQueryOperator=null,o.geometry=null,void(o.spatialRel=null);const S=e.geometry,E=e.spatialRel||"esriSpatialRelIntersects",C=yield(0,O.cW)(E,S,o._serviceInfo.geometryType,o._serviceInfo.hasZ,o._serviceInfo.hasM);(0,p.$P)(o._geometryBounds,S),o._spatialQueryOperator=C,o.geometry=S,o.spatialRel=E})()}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,g.y)(this._serviceInfo.timeInfo,e.timeExtent,y.k);else{const o=new N.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);D.error(o)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const o=e.readHydratedGeometry();return!!o&&this._spatialQueryOperator(o)}_filterByTime(e){return!(0,V.pC)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach((o,S)=>{1&o||(this._idToVisibility.set(S,1),e.push(S))}),e}}}}]);