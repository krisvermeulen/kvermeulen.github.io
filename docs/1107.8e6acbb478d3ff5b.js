"use strict";var Fe=Object.defineProperty,ze=Object.defineProperties,Se=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,Le=(T,P,m)=>P in T?Fe(T,P,{enumerable:!0,configurable:!0,writable:!0,value:m}):T[P]=m,we=(T,P)=>{for(var m in P||(P={}))Re.call(P,m)&&Le(T,m,P[m]);if(Be)for(var m of Be(P))Te.call(P,m)&&Le(T,m,P[m]);return T},me=(T,P)=>ze(T,Se(P));(self.webpackChunkangular_anb=self.webpackChunkangular_anb||[]).push([[1107],{550:(T,P,m)=>{function _(){return[1,0,0,0,1,0,0,0,1]}function L(O,Z){return new Float64Array(O,Z,9)}m.d(P,{a:()=>L,c:()=>_}),Object.freeze({__proto__:null,create:_,clone:function Y(O){return[O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],O[8]]},fromValues:function B(O,Z,x,j,k,G,K,q,Q){return[O,Z,x,j,k,G,K,q,Q]},createView:L})},48977:(T,P,m)=>{m.d(P,{c:()=>re,g:()=>j,j:()=>fe,k:()=>W,m:()=>k,s:()=>x});var _=m(550),Y=m(78451),B=m(28093),L=m(39863),z=m(84161),O=m(993);function x(r,l,y){y*=.5;const d=Math.sin(y);return r[0]=d*l[0],r[1]=d*l[1],r[2]=d*l[2],r[3]=Math.cos(y),r}function j(r,l){const y=2*Math.acos(l[3]),d=Math.sin(y/2);return d>L.E?(r[0]=l[0]/d,r[1]=l[1]/d,r[2]=l[2]/d):(r[0]=1,r[1]=0,r[2]=0),y}function k(r,l,y){const d=l[0],b=l[1],g=l[2],C=l[3],M=y[0],U=y[1],E=y[2],S=y[3];return r[0]=d*S+C*M+b*E-g*U,r[1]=b*S+C*U+g*M-d*E,r[2]=g*S+C*E+d*U-b*M,r[3]=C*S-d*M-b*U-g*E,r}function ee(r,l,y,d){const b=l[0],g=l[1],C=l[2],M=l[3];let U,E,S,X,J,ie=y[0],ne=y[1],ae=y[2],t=y[3];return E=b*ie+g*ne+C*ae+M*t,E<0&&(E=-E,ie=-ie,ne=-ne,ae=-ae,t=-t),1-E>L.E?(U=Math.acos(E),S=Math.sin(U),X=Math.sin((1-d)*U)/S,J=Math.sin(d*U)/S):(X=1-d,J=d),r[0]=X*b+J*ie,r[1]=X*g+J*ne,r[2]=X*C+J*ae,r[3]=X*M+J*t,r}function re(r,l){return r[0]=-l[0],r[1]=-l[1],r[2]=-l[2],r[3]=l[3],r}function A(r,l){const y=l[0]+l[4]+l[8];let d;if(y>0)d=Math.sqrt(y+1),r[3]=.5*d,d=.5/d,r[0]=(l[5]-l[7])*d,r[1]=(l[6]-l[2])*d,r[2]=(l[1]-l[3])*d;else{let b=0;l[4]>l[0]&&(b=1),l[8]>l[3*b+b]&&(b=2);const g=(b+1)%3,C=(b+2)%3;d=Math.sqrt(l[3*b+b]-l[3*g+g]-l[3*C+C]+1),r[b]=.5*d,d=.5/d,r[3]=(l[3*g+C]-l[3*C+g])*d,r[g]=(l[3*g+b]+l[3*b+g])*d,r[C]=(l[3*C+b]+l[3*b+C])*d}return r}function W(r,l,y,d){const b=.5*Math.PI/180;l*=b,y*=b,d*=b;const g=Math.sin(l),C=Math.cos(l),M=Math.sin(y),U=Math.cos(y),E=Math.sin(d),S=Math.cos(d);return r[0]=g*U*S-C*M*E,r[1]=C*M*S+g*U*E,r[2]=C*U*E-g*M*S,r[3]=C*U*S+g*M*E,r}const F=O.c,ve=O.s,Ce=O.a,oe=k,ce=O.b,N=O.d,Me=O.l,le=O.e,H=le,se=O.f,Ue=se,te=O.n,fe=O.g,de=O.h,D=(0,B.c)(),Ae=(0,B.f)(1,0,0),Oe=(0,B.f)(0,1,0),be=(0,Y.a)(),ye=(0,Y.a)(),Pe=(0,_.c)();Object.freeze({__proto__:null,identity:function Z(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r},setAxisAngle:x,getAxisAngle:j,multiply:k,rotateX:function G(r,l,y){y*=.5;const d=l[0],b=l[1],g=l[2],C=l[3],M=Math.sin(y),U=Math.cos(y);return r[0]=d*U+C*M,r[1]=b*U+g*M,r[2]=g*U-b*M,r[3]=C*U-d*M,r},rotateY:function K(r,l,y){y*=.5;const d=l[0],b=l[1],g=l[2],C=l[3],M=Math.sin(y),U=Math.cos(y);return r[0]=d*U-g*M,r[1]=b*U+C*M,r[2]=g*U+d*M,r[3]=C*U-b*M,r},rotateZ:function q(r,l,y){y*=.5;const d=l[0],b=l[1],g=l[2],C=l[3],M=Math.sin(y),U=Math.cos(y);return r[0]=d*U+b*M,r[1]=b*U-d*M,r[2]=g*U+C*M,r[3]=C*U-g*M,r},calculateW:function Q(r,l){const y=l[0],d=l[1],b=l[2];return r[0]=y,r[1]=d,r[2]=b,r[3]=Math.sqrt(Math.abs(1-y*y-d*d-b*b)),r},slerp:ee,random:function v(r){const l=(0,L.R)(),y=(0,L.R)(),d=(0,L.R)(),b=Math.sqrt(1-l),g=Math.sqrt(l);return r[0]=b*Math.sin(2*Math.PI*y),r[1]=b*Math.cos(2*Math.PI*y),r[2]=g*Math.sin(2*Math.PI*d),r[3]=g*Math.cos(2*Math.PI*d),r},invert:function V(r,l){const y=l[0],d=l[1],b=l[2],g=l[3],C=y*y+d*d+b*b+g*g,M=C?1/C:0;return r[0]=-y*M,r[1]=-d*M,r[2]=-b*M,r[3]=g*M,r},conjugate:re,fromMat3:A,fromEuler:W,str:function ue(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},copy:F,set:ve,add:Ce,mul:oe,scale:ce,dot:N,lerp:Me,length:le,len:H,squaredLength:se,sqrLen:Ue,normalize:te,exactEquals:fe,equals:de,rotationTo:function Ie(r,l,y){const d=(0,z.d)(l,y);return d<-.999999?((0,z.c)(D,Ae,l),(0,z.u)(D)<1e-6&&(0,z.c)(D,Oe,l),(0,z.n)(D,D),x(r,D,Math.PI),r):d>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):((0,z.c)(D,l,y),r[0]=D[0],r[1]=D[1],r[2]=D[2],r[3]=1+d,te(r,r))},sqlerp:function he(r,l,y,d,b,g){return ee(be,l,b,g),ee(ye,y,d,g),ee(r,be,ye,2*g*(1-g)),r},setAxes:function _e(r,l,y,d){const b=Pe;return b[0]=y[0],b[3]=y[1],b[6]=y[2],b[1]=d[0],b[4]=d[1],b[7]=d[2],b[2]=-l[0],b[5]=-l[1],b[8]=-l[2],te(r,A(r,b))}})},78451:(T,P,m)=>{function _(){return[0,0,0,1]}function Y(Z){return[Z[0],Z[1],Z[2],Z[3]]}function L(Z,x){return new Float64Array(Z,x,4)}m.d(P,{I:()=>z,a:()=>_,b:()=>Y,c:()=>L});const z=[0,0,0,1];Object.freeze({__proto__:null,create:_,clone:Y,fromValues:function B(Z,x,j,k){return[Z,x,j,k]},createView:L,IDENTITY:z})},14658:(T,P,m)=>{function _(){return new Float32Array(3)}function B(v,V,re){const A=new Float32Array(3);return A[0]=v,A[1]=V,A[2]=re,A}function z(){return _()}function O(){return B(1,1,1)}function Z(){return B(1,0,0)}function x(){return B(0,1,0)}function j(){return B(0,0,1)}m.d(P,{c:()=>_,f:()=>B});const k=z(),G=O(),K=Z(),q=x(),Q=j();Object.freeze({__proto__:null,create:_,clone:function Y(v){const V=new Float32Array(3);return V[0]=v[0],V[1]=v[1],V[2]=v[2],V},fromValues:B,createView:function L(v,V){return new Float32Array(v,V,3)},zeros:z,ones:O,unitX:Z,unitY:x,unitZ:j,ZEROS:k,ONES:G,UNIT_X:K,UNIT_Y:q,UNIT_Z:Q})},61107:(T,P,m)=>{m.r(P),m.d(P,{default:()=>ae});var _=m(62208),Y=m(55713),B=m(48977);function L(){const t=new Float32Array(4);return t[3]=1,t}Object.freeze({__proto__:null,create:L,clone:function z(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function O(t,e,i,a){const c=new Float32Array(4);return c[0]=t,c[1]=e,c[2]=i,c[3]=a,c},createView:function Z(t,e){return new Float32Array(t,e,4)}});var j=m(84161),k=m(14658),G=m(56741),K=m(65234),q=m(53776),Q=m(23899),ee=m(98610),v=m(26584),V=m(58817),re=m(63290);const A=!0;function ue(t,e,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,i+0,10)),version:e.getUint16(i+10,A),checksum:e.getUint32(i+12,A)}}function oe(t,e,i){const a=[];e=ce(t,e,a);const c=[];for(let n=0;n<a.length;n++){c.length=0,e=ce(t,e,c);for(let u=0;u<c.length;u++)i.push(c[u]+a[n])}return e}function ce(t,e,i){const a=new DataView(t,e),c=a.getUint8(0),n=31&c,u=!!(32&c),f=(192&c)>>6;let o=0;if(0===f)o=a.getUint32(1,A),e+=5;else if(1===f)o=a.getUint16(1,A),e+=3;else{if(2!==f)throw new v.Z("lepcc-decode-error","Bad count type");o=a.getUint8(1),e+=2}if(u)throw new v.Z("lepcc-decode-error","LUT not implemented");const h=Math.ceil(o*n/8),s=new Uint8Array(t,e,h);let p=0,w=0,I=0;const R=-1>>>32-n;for(let $=0;$<o;$++){for(;w<n;)p|=s[I]<<w,w+=8,I+=1;i[$]=p&R,p>>>=n,w-=n,w+n>32&&(p|=s[I-1]>>8-w)}return e+I}const te=re.Z.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function fe(t,e,i){let a="",c=0;for(;c<i;){const n=t[e+c];if(n<128)a+=String.fromCharCode(n),c++;else if(n>=192&&n<224){if(c+1>=i)throw new v.Z("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");a+=String.fromCharCode((31&n)<<6|63&t[e+c+1]),c+=2}else if(n>=224&&n<240){if(c+2>=i)throw new v.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");a+=String.fromCharCode((15&n)<<12|(63&t[e+c+1])<<6|63&t[e+c+2]),c+=3}else{if(!(n>=240&&n<248))throw new v.Z("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(c+3>=i)throw new v.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const u=(7&n)<<18|(63&t[e+c+1])<<12|(63&t[e+c+2])<<6|63&t[e+c+3];a+=u>=65536?String.fromCharCode(55296+(u-65536>>10),56320+(1023&u)):String.fromCharCode(u),c+=4}}}return a}function de(t,e){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let a=0;for(let c=0;c<e.length;c++){const n=e[c],u=n.valueType||n.type;i.fields[n.property]=(0,d[u])(t,a),a+=y[u].BYTES_PER_ELEMENT}return i.byteCount=a,i}function D(t,e){return new y[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function he(t,e,i){if(e!==t&&te.error(`Invalid ${i} buffer size\n expected: ${t}, actual: ${e})`),e<t)throw new v.Z("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}const r={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"};function l(t,e,i){if("lepcc-rgb"===t.encoding)return function le(t){const e=new DataView(t,0);let i=0;const{identifier:a,version:c}=ue(t,e,i);if(i+=16,"ClusterRGB"!==a)throw new v.Z("lepcc-decode-error","Bad identifier");if(c>1)throw new v.Z("lepcc-decode-error","Unknown version");const n=function Me(t,e){return{sizeLo:t.getUint32(e+0,A),sizeHi:t.getUint32(e+4,A),count:t.getUint32(e+8,A),colorMapCount:t.getUint16(e+12,A),lookupMethod:t.getUint8(e+14),compressionMethod:t.getUint8(e+15)}}(e,i);if(i+=16,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad size");if((2===n.lookupMethod||1===n.lookupMethod)&&0===n.compressionMethod){if(3*n.colorMapCount+n.count+i!==t.byteLength||n.colorMapCount>256)throw new v.Z("lepcc-decode-error","Bad count");const u=new Uint8Array(t,i,3*n.colorMapCount),f=new Uint8Array(t,i+3*n.colorMapCount,n.count),o=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++){const s=f[h];o[3*h]=u[3*s],o[3*h+1]=u[3*s+1],o[3*h+2]=u[3*s+2]}return o}if(0===n.lookupMethod&&0===n.compressionMethod){if(3*n.count+i!==t.byteLength||0!==n.colorMapCount)throw new v.Z("lepcc-decode-error","Bad count");return new Uint8Array(t,i).slice()}if(n.lookupMethod<=2&&1===n.compressionMethod){if(i+3!==t.byteLength||1!==n.colorMapCount)throw new v.Z("lepcc-decode-error","Bad count");const u=e.getUint8(i),f=e.getUint8(i+1),o=e.getUint8(i+2),h=new Uint8Array(3*n.count);for(let s=0;s<n.count;s++)h[3*s]=u,h[3*s+1]=f,h[3*s+2]=o;return h}throw new v.Z("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}(e);if("lepcc-intensity"===t.encoding)return function Ue(t){const e=new DataView(t,0);let i=0;const{identifier:a,version:c}=ue(t,e,i);if(i+=16,"Intensity "!==a)throw new v.Z("lepcc-decode-error","Bad identifier");if(c>1)throw new v.Z("lepcc-decode-error","Unknown version");const n=function se(t,e){return{sizeLo:t.getUint32(e+0,A),sizeHi:t.getUint32(e+4,A),count:t.getUint32(e+8,A),scaleFactor:t.getUint16(e+12,A),bitsPerPoint:t.getUint8(e+14),reserved:t.getUint8(e+15)}}(e,i);if(i+=16,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad size");const u=new Uint16Array(n.count);if(8===n.bitsPerPoint){if(n.count+i!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad size");const f=new Uint8Array(t,i,n.count);for(let o=0;o<n.count;o++)u[o]=f[o]*n.scaleFactor}else if(16===n.bitsPerPoint){if(2*n.count+i!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad size");const f=new Uint16Array(t,i,n.count);for(let o=0;o<n.count;o++)u[o]=f[o]*n.scaleFactor}else{const f=[];if(ce(t,i,f)!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad size");for(let o=0;o<n.count;o++)u[o]=f[o]*n.scaleFactor}return u}(e);if(null!=t.encoding&&""!==t.encoding)throw new v.Z("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(te.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),"ObjectIds"===t.ordering[0]&&t.hasOwnProperty("objectIds")&&(te.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const a=function Oe(t,e,i){const a=null!=e.header?de(t,e.header):{byteOffset:0,byteCount:0,fields:{count:i}},c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};let n=a.byteCount;for(let u=0;u<e.ordering.length;u++){const f=e.ordering[u],o=(0,V.d9)(e[f]);if(o.count=a.fields.count,"String"===o.valueType){if(o.byteOffset=n,o.byteCount=a.fields[f+"ByteCount"],"UTF-8"!==o.encoding)throw new v.Z("unsupported-encoding","Unsupported String encoding.",{encoding:o.encoding})}else{if(!b(o.valueType))throw new v.Z("unsupported-value-type","Unsupported binary valueType",{valueType:o.valueType});{const h=g(o.valueType);n+=n%h!=0?h-n%h:0,o.byteOffset=n,o.byteCount=h*o.valuesPerElement*o.count}}n+=o.byteCount,c.entries[f]=o}return c.byteCount=n-c.byteOffset,c}(e,t,i);he(a.byteOffset+a.byteCount,e.byteLength,"attribute");const c=a.entries.attributeValues||a.entries.objectIds;if(c){if("String"===c.valueType){const n=a.entries.attributeByteCounts,u=D(e,n),f=function Ae(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}(e,c);return function Ie(t,e,i){const a=[];let c,n,u=0;for(n=0;n<t;n+=1){if(c=e[n],c>0){if(a.push(fe(i,u,c-1)),0!==i[u+c-1])throw new v.Z("string-array-error","Invalid string array: missing null termination.")}else a.push(null);u+=c}return a}(n.count,u,f)}return D(e,c)}throw new v.Z("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const y={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},d={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function b(t){return y.hasOwnProperty(t)}function g(t){return b(t)?y[t].BYTES_PER_ELEMENT:0}function M(t,e){if(null==t.encoding||""===t.encoding){const i=function ye(t,e){const i=de(t,e&&e.header);let a=i.byteCount;const c={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,u=null!=n.vertexCount?n.vertexCount:n.count;for(const h of e.ordering){if(!e.vertexAttributes[h])continue;const s=me(we({},e.vertexAttributes[h]),{byteOffset:a,count:u});c.vertexAttributes[r[h]?r[h]:"_"+h]=s,a+=g(s.valueType)*s.valuesPerElement*u}const f=n.faceCount;if(e.faces&&f){c.faces={};for(const h of e.ordering){if(!e.faces[h])continue;const s=me(we({},e.faces[h]),{byteOffset:a,count:f});c.faces[h]=s,a+=g(s.valueType)*s.valuesPerElement*f}}const o=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&o){c.featureAttributes={};for(const h of e.featureAttributeOrder){if(!e.featureAttributes[h])continue;const s=me(we({},e.featureAttributes[h]),{byteOffset:a,count:o});c.featureAttributes[h]=s,a+=("UInt64"===s.valueType?8:g(s.valueType))*s.valuesPerElement*o}}return he(a,t.byteLength,"geometry"),c.byteCount=a-c.byteOffset,c}(e,t);if((0,_.Wi)(i.vertexAttributes.position))return;const a=D(e,i.vertexAttributes.position),c=i.header.fields,n=[c.offsetX,c.offsetY,c.offsetZ],u=[c.scaleX,c.scaleY,c.scaleZ],f=a.length/3,o=new Float64Array(3*f);for(let h=0;h<f;h++)o[3*h]=a[3*h]*u[0]+n[0],o[3*h+1]=a[3*h+1]*u[1]+n[1],o[3*h+2]=a[3*h+2]*u[2]+n[2];return o}if("lepcc-xyz"===t.encoding)return function Ce(t){const e=new DataView(t,0);let i=0;const{identifier:a,version:c}=ue(t,e,i);if(i+=16,"LEPCC     "!==a)throw new v.Z("lepcc-decode-error","Bad identifier");if(c>1)throw new v.Z("lepcc-decode-error","Unknown version");const n=function ve(t,e){return{sizeLo:t.getUint32(e+0,A),sizeHi:t.getUint32(e+4,A),minX:t.getFloat64(e+8,A),minY:t.getFloat64(e+16,A),minZ:t.getFloat64(e+24,A),maxX:t.getFloat64(e+32,A),maxY:t.getFloat64(e+40,A),maxZ:t.getFloat64(e+48,A),errorX:t.getFloat64(e+56,A),errorY:t.getFloat64(e+64,A),errorZ:t.getFloat64(e+72,A),count:t.getUint32(e+80,A),reserved:t.getUint32(e+84,A)}}(e,i);if(i+=88,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad size");const u=new Float64Array(3*n.count),f=[],o=[],h=[],s=[];if(i=oe(t,i,f),i=oe(t,i,o),i=oe(t,i,h),i=oe(t,i,s),i!==t.byteLength)throw new v.Z("lepcc-decode-error","Bad length");let p=0,w=0;for(let I=0;I<f.length;I++){w+=f[I];let R=0;for(let $=0;$<o[I];$++){R+=h[p];const ge=s[p];u[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*R),u[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*w),u[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*ge),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:u}}(e).result}function U(t,e,i){return(0,_.pC)(t)&&t.attributeInfo.useElevation?function E(t,e){const i=new Float64Array(e);for(let a=0;a<e;a++)i[a]=t[3*a+2];return i}(e,i):(0,_.pC)(t)?l(t.attributeInfo.storageInfo,t.buffer,i):null}function X(t){return null==t||"none"===t?null:"low-four-bit"===t?e=>15&e:"high-four-bit"===t?e=>(240&e)>>4:"absolute-value"===t?e=>Math.abs(e):"modulo-ten"===t?e=>e%10:null}function J(t){let e=0;for(const i of t||[])e|=1<<i;return e}class ie{transform(e){const i=this._transform(e),a=[i.points.buffer,i.rgb.buffer];(0,_.pC)(i.pointIdFilterMap)&&a.push(i.pointIdFilterMap.buffer);for(const c of i.attributes)"buffer"in c.values&&(0,Y.eP)(c.values.buffer)&&c.values.buffer!==i.rgb.buffer&&a.push(c.values.buffer);return Promise.resolve({result:i,transferList:a})}_transform(e){const i=M(e.schema,e.geometryBuffer);let a=i.length/3,c=null;const n=[],u=U(e.primaryAttributeData,i,a);(0,_.pC)(e.primaryAttributeData)&&u&&n.push({attributeInfo:e.primaryAttributeData.attributeInfo,values:u});const f=U(e.modulationAttributeData,i,a);(0,_.pC)(e.modulationAttributeData)&&f&&n.push({attributeInfo:e.modulationAttributeData.attributeInfo,values:f});let o=function C(t,e,i,a){const{rendererJSON:c,isRGBRenderer:n}=t;let u=null,f=null;if(e&&n)u=e;else if(e&&"pointCloudUniqueValueRenderer"===c.type){f=ee.Z.fromJSON(c);const o=f.colorUniqueValueInfos;u=new Uint8Array(3*a);const h=X(f.fieldTransformType);for(let s=0;s<a;s++){const p=(h?h(e[s]):e[s])+"";for(let w=0;w<o.length;w++)if(o[w].values.indexOf(p)>=0){u[3*s]=o[w].color.r,u[3*s+1]=o[w].color.g,u[3*s+2]=o[w].color.b;break}}}else if(e&&"pointCloudStretchRenderer"===c.type){f=Q.Z.fromJSON(c);const o=f.stops;u=new Uint8Array(3*a);const h=X(f.fieldTransformType);for(let s=0;s<a;s++){const p=h?h(e[s]):e[s],w=o.length-1;if(p<o[0].value)u[3*s]=o[0].color.r,u[3*s+1]=o[0].color.g,u[3*s+2]=o[0].color.b;else if(p>=o[w].value)u[3*s]=o[w].color.r,u[3*s+1]=o[w].color.g,u[3*s+2]=o[w].color.b;else for(let I=1;I<o.length;I++)if(p<o[I].value){const R=(p-o[I-1].value)/(o[I].value-o[I-1].value);u[3*s]=o[I].color.r*R+o[I-1].color.r*(1-R),u[3*s+1]=o[I].color.g*R+o[I-1].color.g*(1-R),u[3*s+2]=o[I].color.b*R+o[I-1].color.b*(1-R);break}}}else if(e&&"pointCloudClassBreaksRenderer"===c.type){f=q.Z.fromJSON(c);const o=f.colorClassBreakInfos;u=new Uint8Array(3*a);const h=X(f.fieldTransformType);for(let s=0;s<a;s++){const p=h?h(e[s]):e[s];for(let w=0;w<o.length;w++)if(p>=o[w].minValue&&p<=o[w].maxValue){u[3*s]=o[w].color.r,u[3*s+1]=o[w].color.g,u[3*s+2]=o[w].color.b;break}}}else{u=new Uint8Array(3*a);for(let o=0;o<u.length;o++)u[o]=255}if(i&&f&&f.colorModulation){const o=f.colorModulation.minValue,h=f.colorModulation.maxValue,s=.3;for(let p=0;p<a;p++){const w=i[p],I=w>=h?1:w<=o?s:s+(1-s)*(w-o)/(h-o);u[3*p]=I*u[3*p],u[3*p+1]=I*u[3*p+1],u[3*p+2]=I*u[3*p+2]}}return u}(e.rendererInfo,u,f,a);if(e.filterInfo&&e.filterInfo.length>0&&(0,_.pC)(e.filterAttributesData)){const s=e.filterAttributesData.map(p=>{const w=U(p,i,a),I={attributeInfo:p.attributeInfo,values:w};return n.push(I),I});c=new Uint32Array(a),a=function S(t,e,i,a,c){const n=t.length/3;let u=0;for(let f=0;f<n;f++){let o=!0;for(let h=0;h<a.length&&o;h++){const{filterJSON:s}=a[h],p=c[h].values[f];switch(s.type){case"pointCloudValueFilter":{const w="exclude"===s.mode;-1!==s.values.indexOf(p)===w&&(o=!1);break}case"pointCloudBitfieldFilter":{const w=J(s.requiredSetBits),I=J(s.requiredClearBits);(p&w)===w&&0==(p&I)||(o=!1);break}case"pointCloudReturnFilter":{const w=15&p,I=p>>>4&15,R=I>1,$=1===w,ge=w===I;let Ee=!1;for(const pe of s.includedReturns)if("last"===pe&&ge||"firstOfMany"===pe&&$&&R||"lastOfMany"===pe&&ge&&R||"single"===pe&&!R){Ee=!0;break}Ee||(o=!1);break}}}o&&(i[u]=f,t[3*u]=t[3*f],t[3*u+1]=t[3*f+1],t[3*u+2]=t[3*f+2],e[3*u]=e[3*f],e[3*u+1]=e[3*f+1],e[3*u+2]=e[3*f+2],u++)}return u}(i,o,c,e.filterInfo,s)}for(const s of e.userAttributesData){const p=U(s,i,a);n.push({attributeInfo:s.attributeInfo,values:p})}3*a<o.length&&(o=new Uint8Array(o.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(i,a,e.elevationOffset);const h=this._transformCoordinates(i,a,e.obb,K.Z.fromJSON(e.inSR),K.Z.fromJSON(e.outSR));return{obb:e.obb,points:h,rgb:o,attributes:n,pointIdFilterMap:c}}_transformCoordinates(e,i,a,c,n){if(!(0,G.CM)(e,c,0,e,n,0,i))throw Error("Can't reproject");const u=(0,k.f)(a.center[0],a.center[1],a.center[2]),f=(0,k.c)(),o=(0,k.c)();(0,B.c)(ne,a.quaternion);const h=new Float32Array(3*i);for(let s=0;s<i;s++)f[0]=e[3*s]-u[0],f[1]=e[3*s+1]-u[1],f[2]=e[3*s+2]-u[2],(0,j.q)(o,f,ne),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(o[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(o[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(o[2])),h[3*s]=f[0],h[3*s+1]=f[1],h[3*s+2]=f[2];return h}_applyElevationOffsetInPlace(e,i,a){if(0!==a)for(let c=0;c<i;c++)e[3*c+2]+=a}}const ne=L();function ae(){return new ie}}}]);