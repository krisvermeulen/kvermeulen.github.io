"use strict";var X=Object.defineProperty,$=Object.defineProperties,q=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,j=(m,u,i)=>u in m?X(m,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[u]=i,O=(m,u)=>{for(var i in u||(u={}))k.call(u,i)&&j(m,i,u[i]);if(z)for(var i of z(u))_.call(u,i)&&j(m,i,u[i]);return m},A=(m,u)=>$(m,q(u));(self.webpackChunkangular_anb=self.webpackChunkangular_anb||[]).push([[5391],{22264:(m,u,i)=>{function v(a,l){return l?"xoffset"in l&&l.xoffset?Math.max(a,Math.abs(l.xoffset)):"yoffset"in l&&l.yoffset?Math.max(a,Math.abs(l.yoffset||0)):a:a}function g(a,l){return"number"==typeof a?a:a&&a.stops&&a.stops.length?function I(a){let l=0,h=0;for(let c=0;c<a.length;c++){const o=a[c].size;"number"==typeof o&&(l+=o,h++)}return l/h}(a.stops):l}function T(a){const l=a&&a.renderer,h="touch"===(a&&a.event&&a.event.pointerType)?9:6;if(!l)return h;const c="visualVariables"in l?function M(a,l){if(!l)return a;const h=l.filter(p=>"size"===p.type).map(p=>{const{maxSize:w,minSize:P}=p;return(g(w,a)+g(P,a))/2});let c=0;const o=h.length;if(0===o)return a;for(let p=0;p<o;p++)c+=h[p];const f=Math.floor(c/o);return Math.max(f,a)}(h,l.visualVariables):h;if("simple"===l.type)return v(c,l.symbol);if("unique-value"===l.type){let o=c;return l.uniqueValueInfos.forEach(f=>{o=v(o,f.symbol)}),o}if("class-breaks"===l.type){let o=c;return l.classBreakInfos.forEach(f=>{o=v(o,f.symbol)}),o}return c}i.d(u,{k:()=>T})},55391:(m,u,i)=>{i.r(u),i.d(u,{default:()=>H});var v=i(15861),I=i(17626),g=i(26584),M=i(63290),T=i(10699),a=i(77712),o=(i(85931),i(8314),i(90912),i(76898)),f=i(91082),p=i(37384),w=i(88893),P=i(9598),R=i(58098),L=i(8480),D=i(79527),b=i(45611),S=i(94421),B=i(62208),K=i(22264);const W=e=>{let r=class extends e{fetchPopupFeatures(s,Z){var V=this;return(0,v.Z)(function*(){const{layer:U}=V;if(!s)return Promise.reject(new g.Z("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:U}));if("tile"!==U.type)return Promise.reject(new g.Z("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:U.type}));const E=V.get("view.scale"),C=U.allSublayers.toArray().filter(y=>y.popupTemplate&&y.popupEnabled&&y.visible&&(0===y.minScale||E<=y.minScale)&&(0===y.maxScale||E>=y.maxScale));return(0,T.as)(C.map(function(){var y=(0,v.Z)(function*(d){const x=d.createQuery(),F=(0,B.pC)(Z)?Z.event:null,J=(0,K.k)({renderer:d.renderer,event:F});return x.geometry=V.createFetchPopupFeaturesQueryGeometry(s,J),x.outFields=yield d.popupTemplate.getRequiredFields(),(yield d.queryFeatures(x)).features});return function(d){return y.apply(this,arguments)}}())).then(y=>[].concat(...y.map(d=>d.value).filter(Boolean)))})()}};return(0,I._)([(0,a.Cb)()],r.prototype,"layer",void 0),r=(0,I._)([(0,o.j)("esri.layers.mixins.TileLayerView")],r),r};var G=i(94672);const N=M.Z.getLogger("esri.views.2d.layers.TileLayerView2D"),Y=[0,0];let Q=class extends(W((0,S.y)((0,f.Y)((0,p.y)(b.Z))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,r=e&&e.spatialReference;let s;r||(s=new g.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer})),r.equals(this.view.spatialReference)||(s=new g.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})),this.watch("resampling",()=>{this.doRefresh()}),s&&this.addResolvingPromise(Promise.reject(s))}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange("updating")}attach(){const e="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new P.Z(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new L.Z({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(r,s)=>this.fetchTile(r,s)}),this._tileStrategy=new D.Z({cachePolicy:"keep",resampling:this.resampling,acquireTile:r=>this.acquireTile(r),releaseTile:r=>this.releaseTile(r),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,r){return(0,G.K)(e,r,this.view)}doRefresh(){var e=this;return(0,v.Z)(function*(){e.updateRequested||e.suspended||(e._fetchQueue.reset(),e._tileStrategy.tiles.forEach(r=>e._enqueueTileFetch(r)),e.notifyChange("updating"))})()}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const r=this._bitmapView.createTile(e),s=r.bitmap;return[s.x,s.y]=this._tileInfoView.getTileCoords(Y,r.key),s.resolution=this._tileInfoView.getTileResolution(r.key),[s.width,s.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(r),this._bitmapView.addChild(r),this.requestUpdate(),r}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,r={}){var s=this;return(0,v.Z)(function*(){const Z="tilemapCache"in s.layer?s.layer.tilemapCache:null,{signal:V,resamplingLevel:U=0}=r;if(!Z)try{return yield s._fetchImage(e,V)}catch(y){if(!(0,T.D_)(y)&&!s.resampling)return(0,w.V)(s._tileInfoView.tileInfo.size);if(U<3){const d=s._tileInfoView.getTileParentId(e.id);if(d){const x=new R.Z(d),F=yield s.fetchTile(x,A(O({},r),{resamplingLevel:U+1}));return(0,w.i)(s._tileInfoView,F,x,e)}}throw y}const E=new R.Z(0,0,0,0);let C;try{if(yield Z.fetchAvailabilityUpsample(e.level,e.row,e.col,E,{signal:V}),E.level!==e.level&&!s.resampling)return(0,w.V)(s._tileInfoView.tileInfo.size);C=yield s._fetchImage(E,V)}catch(y){if((0,T.D_)(y))throw y;C=yield s._fetchImage(e,V)}return s.resampling?(0,w.i)(s._tileInfoView,C,E,e):C})()}_enqueueTileFetch(e){var r=this;return(0,v.Z)(function*(){if(!r._fetchQueue.has(e.key.id)){try{const s=yield r._fetchQueue.push(e.key);e.bitmap.source=s,e.bitmap.width=r._tileInfoView.tileInfo.size[0],e.bitmap.height=r._tileInfoView.tileInfo.size[1],e.once("attach",()=>r.requestUpdate())}catch(s){(0,T.D_)(s)||N.error(s)}r.requestUpdate()}})()}_fetchImage(e,r){var s=this;return(0,v.Z)(function*(){return s.layer.fetchTile(e.level,e.row,e.col,{signal:r})})()}};(0,I._)([(0,a.Cb)()],Q.prototype,"resampling",null),Q=(0,I._)([(0,o.j)("esri.views.2d.layers.TileLayerView2D")],Q);const H=Q},94672:(m,u,i)=>{i.d(u,{K:()=>T}),i(29132);var I=i(62208),g=i(16730),M=i(2004);function T(h,c,o,f=new M.Z){let p;if("2d"===o.type)p=c*o.resolution;else if("3d"===o.type){const b=o.overlayPixelSizeInMapUnits(h),S=o.basemapSpatialReference;p=(0,I.pC)(S)&&!S.equals(o.spatialReference)?(0,g.c9)(S)/(0,g.c9)(o.spatialReference):c*b}const w=h.x-p,P=h.y-p,R=h.x+p,L=h.y+p,{spatialReference:D}=o;return f.xmin=Math.min(w,R),f.ymin=Math.min(P,L),f.xmax=Math.max(w,R),f.ymax=Math.max(P,L),f.spatialReference=D,f}new M.Z}}]);